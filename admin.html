<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Panel â€” SmartSoil</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
</head>
<body class="app">
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">ðŸŒ±</div>
      <div class="brand-text"><h3>SmartSoil</h3><div class="small muted">Admin Panel</div></div>
    </div>
    <nav class="nav">
      <ul>
        <li onclick="navTo('dashboard')">Overview</li>
        <li onclick="navTo('fields')">Fields</li>
        <li onclick="navTo('alerts')">Alerts</li>
        <li onclick="navTo('reports')">Reports</li>
        <li onclick="navTo('settings')">Settings</li>
        <li class="active" onclick="navTo('admin')">Admin</li>
      </ul>
    </nav>
    <div style="margin-top:auto">
      <button class="btn btn-ghost" onclick="logoutUser()">Logout</button>
    </div>
  </aside>

  <main class="main">
    <header class="topbar">
      <div>
        <h2>Admin Panel</h2>
        <div class="small muted">Manage users & system</div>
      </div>
      <div class="small">Hello, <span id="user-name">Admin</span></div>
    </header>

    <section class="container content">
      <div class="grid">
        <div class="card">
          <h4><i class="fas fa-users"></i> User Management</h4>
          <p class="small muted">View and manage registered users</p>
          <table id="user-table" class="admin-table">
            <thead>
              <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Users will be populated here -->
            </tbody>
          </table>
        </div>

        <div class="card">
          <h4><i class="fas fa-chart-line"></i> System Overview</h4>
          <p class="small muted">Quick links to system sections</p>
          <div class="admin-links">
            <a href="#" onclick="navTo('dashboard')" class="admin-link"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="#" onclick="navTo('fields')" class="admin-link"><i class="fas fa-seedling"></i> Fields</a>
            <a href="#" onclick="navTo('alerts')" class="admin-link"><i class="fas fa-bell"></i> Alerts</a>
            <a href="#" onclick="navTo('reports')" class="admin-link"><i class="fas fa-file-alt"></i> Reports</a>
          </div>
        </div>

        <div class="card">
          <h4><i class="fas fa-cogs"></i> System Stats</h4>
          <div class="stat-grid">
            <div class="stat-item">
              <div class="stat-number" id="total-users">0</div>
              <div class="small muted">Total Users</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="active-fields">2</div>
              <div class="small muted">Active Fields</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="active-alerts">0</div>
              <div class="small muted">Active Alerts</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (!isAdmin()) {
        alert('Access denied. Admin privileges required.');
        window.location.href = 'dashboard.html';
        return;
      }

      // Populate user table
      const users = JSON.parse(localStorage.getItem('smartsoil_users') || '[]');
      const tbody = document.getElementById('user-table').querySelector('tbody');
      users.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${user.username}</td>
          <td>${user.email}</td>
          <td>${user.role}</td>
          <td>
            <button class="btn btn-small" onclick="editUser('${user.username}')">Edit</button>
            <button class="btn btn-small btn-danger" onclick="deleteUser('${user.username}')">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      // Update stats
      document.getElementById('total-users').textContent = users.length;
    });

    function editUser(username) {
      alert('Edit user: ' + username + ' (Demo: not implemented)');
    }

    function deleteUser(username) {
      if (confirm('Delete user: ' + username + '?')) {
        const users = JSON.parse(localStorage.getItem('smartsoil_users') || '[]');
        const filtered = users.filter(u => u.username !== username);
        localStorage.setItem('smartsoil_users', JSON.stringify(filtered));
        location.reload();
      }
    }
  </script>
</body>
</html>
